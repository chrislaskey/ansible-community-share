---

- name: Clone project repository
  git: 
    repo: git://github.com/chrislaskey/community-share.git 
    dest: /home/ubuntu/current
    accept_hostkey: true

- name: Create ENV file
  template:
    src: .env.j2
    dest: /home/ubuntu/current/.env

- name: Create puma run directory
  file:
    path: /home/ubuntu/current/tmp/puma
    state: directory
    mode: 0755

- name: Install project gems
  shell: cd current && bash -lc "bundle install"

- name: Install project database
  shell: cd current && bash -lc "bundle exec rake db:migrate db:seed"

- name: Precompile assets
  shell: cd current && bash -lc "bundle exec rails assets:precompile"
